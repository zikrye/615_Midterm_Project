---
title: "data"
author: "Clare Tang"
date: "2021/10/25"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(tidyverse)
library(magrittr)
```



```{r}

strb <- read.csv("strawberry_test.csv")


#
View(pest)
View(strb)

dim(strb) # 10215 21

```


## NA data, columns with only one value
```{r}

colSums(is.na(strb)) 



drop_no_info_cols <- function(df){
  cnames <- colnames(strb)
  T = NULL
  for(i in 1:ncol(df)){T <- c(T, nrow(unique(df[i])))} # unique values of each column
  drop_cols <- cnames[which(T == 1)]
  return(select(df, !all_of(drop_cols)))
}

# columns with only one value: Geo.Level(STATE); watershed_code(0); Commodity(STRAWBERRIES)

strb <- drop_no_info_cols(strb)
colnames(strb)

```

## type of chemicals
```{r}
# View(strb)


strb %<>% separate(col = Data.Item, into = c("Strawberries", "items", "discription", "units"), sep = ",", fill = "right")

unique(strb$Strawberries)
unique(strb$items)
unique(strb$discription)
unique(strb$units) 

distinct(strab, Domain)



# copy column of Domain.Category
strb %<>% 
  mutate(Chemicals = Domain.Category) %>% 
  relocate(Chemicals, .after = Domain.Category)

strb %<>% separate(col = Chemicals,
                     into = c("chemical.type", "chemical"),
                     sep = ":",
                     fill = "right")


strb$chemical <- str_extract(str_trim(strb$chemical) ,"[^(].*[^)]")

distinct(strb, chemical.type)


strb %<>% separate(col = chemical, 
                    into = c("chemical", "che_num"), 
                    sep = "=", 
                    fill = "right")


```





## pest
```{r}

pest <- read.csv("pesticides.csv")
dim(pest)
View(pest)
colnames(pest)
names(pest)[1] <- "Pesticide"

pest <- pest[!apply(pest == "",1, all), ] # delete empty rows

# include empty relationship
l_pest <- pest %>% gather(Toxicity, Level, Carcinogen:Bee.Toxins, -Pesticide)

# clarify a new column, human or bee
l_pest <- mutate(l_pest, humanORbee = ifelse(Toxicity == "Bee.Toxins", "Bee", "Human"))

# without empty relationship
rela_pest <- l_pest[!(l_pest$Level == ""), ]
View(rela_pest)

# turn name into capital letters
rela_pest$Pesticide <- toupper(rela_pest$Pesticide)

names(rela_pest)[1] <- "chemical"


```

## combine pest into strab

```{r}

strb$chemical <- str_trim(strb$chemical)
strb$discription <- str_trim(strb$discription)

df <- merge(x= strb, y = rela_pest, by = "chemical")
View(df)

df %<>% select(chemical, chemical.type, humanORbee, Level, State, Year, discription, Value, Year)

df %<>% filter(!Value == " (D)" & !Value == " (Z)")

df %<>% filter(discription == "MEASURED IN LB / ACRE / APPLICATION")

```